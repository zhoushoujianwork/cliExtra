{
  "version": "2.0",
  "metadata": {
    "name": "ä¸‰è§’è‰²åä½œå¼€å‘æµç¨‹",
    "description": "åç«¯->å‰ç«¯->è¿ç»´çš„ç®€å•åä½œæµç¨‹",
    "namespace": "simple_dev"
  },
  "roles": {
    "backend": {
      "name": "åç«¯å·¥ç¨‹å¸ˆ",
      "instance_pattern": "*backend*",
      "responsibilities": ["APIå¼€å‘", "æ¥å£è®¾è®¡", "æ•°æ®åº“æ“ä½œ"],
      "tools": ["git", "database", "postman"]
    },
    "frontend": {
      "name": "å‰ç«¯å·¥ç¨‹å¸ˆ", 
      "instance_pattern": "*frontend*",
      "responsibilities": ["UIå®ç°", "æ¥å£è°ƒç”¨", "ç”¨æˆ·äº¤äº’"],
      "tools": ["git", "npm", "browser"]
    },
    "devops": {
      "name": "è¿ç»´å·¥ç¨‹å¸ˆ",
      "instance_pattern": "*devops*", 
      "responsibilities": ["éƒ¨ç½²", "ç›‘æ§", "ç¯å¢ƒç®¡ç†"],
      "tools": ["docker", "kubernetes", "monitoring"]
    }
  },
  "nodes": {
    "start": {
      "id": "start",
      "type": "start",
      "title": "æ–°éœ€æ±‚å¼€å§‹"
    },
    "backend_dev": {
      "id": "backend_dev",
      "type": "task",
      "title": "åç«¯æ¥å£å¼€å‘",
      "owner": "backend",
      "deliverables": ["APIæ¥å£", "æ¥å£æ–‡æ¡£", "æµ‹è¯•æ•°æ®"],
      "completion_trigger": {
        "action": "notify_next",
        "target": "frontend",
        "message_template": "ğŸš€ åç«¯æ¥å£å¼€å‘å®Œæˆï¼\n\nğŸ“‹ å®Œæˆå†…å®¹ï¼š\n{deliverables}\n\nğŸ“– æ¥å£æ–‡æ¡£ï¼š{api_docs}\nğŸ”— æµ‹è¯•åœ°å€ï¼š{test_url}\n\nè¯·å¼€å§‹å‰ç«¯é›†æˆå¼€å‘ï¼Œæœ‰é—®é¢˜éšæ—¶è”ç³»ï¼",
        "auto_send": true
      }
    },
    "frontend_review": {
      "id": "frontend_review",
      "type": "decision",
      "title": "å‰ç«¯é›†æˆå’Œè¯„å®¡",
      "owner": "frontend",
      "options": [
        {
          "choice": "accept",
          "label": "æ¥å£æ»¡è¶³éœ€æ±‚",
          "next": "frontend_dev"
        },
        {
          "choice": "reject", 
          "label": "éœ€è¦åç«¯è°ƒæ•´",
          "next": "backend_feedback"
        }
      ]
    },
    "backend_feedback": {
      "id": "backend_feedback",
      "type": "task",
      "title": "åç«¯æ ¹æ®åé¦ˆè°ƒæ•´",
      "owner": "backend",
      "trigger_message": "éœ€è¦è°ƒæ•´æ¥å£",
      "completion_trigger": {
        "action": "notify_next",
        "target": "frontend", 
        "message_template": "ğŸ”„ æ¥å£å·²æ ¹æ®åé¦ˆè°ƒæ•´å®Œæˆï¼\n\nğŸ› ï¸ è°ƒæ•´å†…å®¹ï¼š\n{changes}\n\nè¯·é‡æ–°æµ‹è¯•é›†æˆï¼Œè°¢è°¢ï¼",
        "auto_send": true
      }
    },
    "frontend_dev": {
      "id": "frontend_dev", 
      "type": "task",
      "title": "å‰ç«¯å¼€å‘é›†æˆ",
      "owner": "frontend",
      "deliverables": ["å‰ç«¯é¡µé¢", "æ¥å£é›†æˆ", "åŠŸèƒ½æµ‹è¯•"],
      "completion_trigger": {
        "action": "notify_next",
        "target": "devops",
        "message_template": "âœ… å‰åç«¯å¼€å‘å®Œæˆï¼Œå¯ä»¥éƒ¨ç½²äº†ï¼\n\nğŸ“¦ äº¤ä»˜å†…å®¹ï¼š\n- åç«¯ï¼š{backend_deliverables}\n- å‰ç«¯ï¼š{frontend_deliverables}\n\nğŸš€ è¯·å¼€å§‹éƒ¨ç½²æµç¨‹ï¼",
        "auto_send": true
      }
    },
    "deployment": {
      "id": "deployment",
      "type": "task", 
      "title": "è¿ç»´éƒ¨ç½²",
      "owner": "devops",
      "deliverables": ["éƒ¨ç½²å®Œæˆ", "ç¯å¢ƒéªŒè¯", "ç›‘æ§é…ç½®"],
      "completion_trigger": {
        "action": "broadcast_all",
        "message_template": "ğŸ‰ éƒ¨ç½²å®Œæˆï¼\n\nğŸŒ è®¿é—®åœ°å€ï¼š{deploy_url}\nğŸ“Š ç›‘æ§åœ°å€ï¼š{monitor_url}\n\nåŠŸèƒ½å·²ä¸Šçº¿ï¼Œå¤§å®¶è¾›è‹¦äº†ï¼",
        "auto_send": true
      }
    },
    "end": {
      "id": "end",
      "type": "end",
      "title": "éœ€æ±‚å®Œæˆ"
    }
  },
  "edges": [
    {"from": "start", "to": "backend_dev"},
    {"from": "backend_dev", "to": "frontend_review"},
    {"from": "frontend_review", "to": "frontend_dev", "condition": "accept"},
    {"from": "frontend_review", "to": "backend_feedback", "condition": "reject"},
    {"from": "backend_feedback", "to": "frontend_review"},
    {"from": "frontend_dev", "to": "deployment"},
    {"from": "deployment", "to": "end"}
  ],
  "auto_triggers": {
    "task_complete": {
      "enabled": true,
      "command_template": "qq send {target_instance} \"{message}\""
    },
    "instance_matching": {
      "backend": "qq list | grep backend | head -1",
      "frontend": "qq list | grep frontend | head -1", 
      "devops": "qq list | grep devops | head -1"
    }
  }
}
